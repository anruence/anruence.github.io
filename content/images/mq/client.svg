<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="946" height="558" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&quot; version=&quot;7.9.5&quot; editor=&quot;www.draw.io&quot;&gt;&lt;diagram id=&quot;210e5044-ab44-9cf8-edbb-0238b88f5439&quot; name=&quot;第 1 页&quot;&gt;5VpLc6M4EP41Ou4UICTEETt49jBbNVU57OwRG9lmgy0XJok9v34lkAwCOcPEgjw2SVVwSwjx9ePrbhnA+e70tUgO279YSnPgOekJwDvgeS70If8nJOdaEijBpshSOakR3Gc/qRQ6UvqYpfSoTSwZy8vsoAtXbL+nq1KTJUXBnvVpa5brTz0kG9oT3K+SvC/9O0vLbS0lXtDI/6TZZque7OKwHlkmq4dNwR738nnAg+vqpx7eJWot+aLHbZKy55YIxgDOC8bK+mp3mtNcYKtgq+9bXBm97Lug+3LIDVjq5SnJH6nacrWx8qzAqF6HihtcAGfP26yk94dkJUafufq5bFvucjm8zvJ8znJWVPfCNRK/XH4sC/ZAWyO4+uEj/S3Lt3iiRUlPLZF8ha+U7WhZnPkUORpAVN8izc31JbzPjfJgKGXbluIglsJEGszmsnYDGr+QuJkxRO5nwNAlv8bQ98bCEOIeZDTlLik/sqLcsg3bJ3ncSGcNqI4OID1l5Y/W9T9iyhcBIcenOP+Qd1QfmrF/aVmeZSxKHkvGRc1zvzF2kCteBfvIHouV3L0nA0KZFBuqkJLOJt7sRZUUNE/K7EkPRrfAq3ZjzUQtGJznOLrBhX2Dc5Vjtw3uEjxvMjinj0iMQTgH0RzESFzMHBD7YBYBMhMSEoHIfQE1ZxrUXB01DxlQM7mpFS81RLqYgCiusEJgdgdCJGCcYUCIuCAuiBYgDgR6XCgkjhDeBGM3PpIVXa1M8XFJkI+ccYCHcErg+zSdLnsg8mTiIC5X5zzjaBa/RnJZw/5teQXaNKFkbYQWrwhdru1ACwOdei6QtaDFBmSJBWR9MgbxSLKR1OP+BrmkyXF7CcKDmAYGtllF3vqdZfyxFy2hTpKFUAf+murkXR0NXLYxSCkYG+IMj8ALELqG8NJVIDe7UtdLQY/Zz2RZTRAqO4hNVttGM4DuuCTJs81e+A6HuvIcYb4ZrwgiObDL0rRSfp4saT675PntQFRn+ia9KTPrOcWlhpG7A+06wOQsfzhfXA8SnTrrT69VsJrC1usjvVV3qJ9Z2HCoXiZnNVtTPvQ+sjW1m475c5oNoypJCSou5bnJTPw1uQnOhd2n2RO/3IjLip0XahJ3H6ySnEiuSOaVHxHAsy9O0/wBxDe5WL0033l79WsEtKWnhOtBOBotMv7+wqOU9LsSee+U6f0BdGRkeht8BMMx3KdfCA11n6ZgauonxWnDXItM4VpmyvJ9XZNwIGVFRZGcW9MkXVx/jqM/x8dOR+f1iq+NqX4wTZJyrToOrMdbg1H47lvFW2yOtx853VBvZCPdgJ7j6ZkfuS3fOOnLqFVDfQEr2YgytIGqjTlXziUnhpxcKyrkpCnK2/7kfuU7bp27Xntm9kvxEiNLfcBunetPWef6E7Cf9WBmP3CZ/YV4HZbp9sEsFmAmt+E2HYOo6u+EvrTyDxgaVSvURmj0AnUkpHLF2yKj1din7LKlxF2yfkh6Whqhb4QoSX1TqCLeEto6skBOtyOBeqFqtL6RZySWcCEaxrJtHA/oH/c9RIdsz/a0g68UDfcTkzL1oGmDNzrtoQuPtJSBYF8ZNpr5eJSew+uLpkG0gSbq24XdIsgZjzZGoW+9TrmUJoai1Ok2UEdRWLtoUQdrlpX4uwUo8XxNx2Hn1L8z/cLvxuk3l6uB6WwtFBmx6F8FIkiKNILHRiKiokgjiPjrR8t+j+oDZBjYWobhfHFgELyjlAIZKuXrJc4058gBwpoxT3uOjMyZ8rs/Rw6wjtqk58iq1O+A1q2vkagzxEUdKaoaPOJldSDb2gQbW968GufBxhORJroDJKxA5zf4VRDiJfrdwHb2W+tk0iNmbAra/+eENghd3UOmTGj7pdsnOu8P0dud92PfYOaBCDThQlp3FKiuXz+d/TTWDbtf9zPowDfowIp1o5fCPxFtVw7959dB2P0G3Hg64B+bLxXXiV/zzW0Y/wc=&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g transform="translate(3,3)"><rect x="550" y="57" width="390" height="360" rx="54" ry="54" fill="#f5f5f5" stroke="#666666" pointer-events="none"/><rect x="0" y="57" width="420" height="360" rx="54" ry="54" fill="#f5f5f5" stroke="#666666" pointer-events="none"/><path d="M 150 217 L 183.63 217" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 188.88 217 L 181.88 220.5 L 183.63 217 L 181.88 213.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="15" y="107" width="135" height="220" rx="20.25" ry="20.25" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="25" y="167" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(60.5,190.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="48" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 49px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">本地事务</div></div></foreignObject></g><rect x="25" y="247" width="120" height="60" fill="#f8cecc" stroke="#b85450" pointer-events="none"/><g transform="translate(48.5,270.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="72" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 73px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">记录消息状态</div></div></foreignObject></g><path d="M 190 193 C 190 171.67 250 171.67 250 193 L 250 241 C 250 262.33 190 262.33 190 241 Z" fill="#dae8fc" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="none"/><path d="M 190 193 C 190 209 250 209 250 193" fill="none" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(212.5,222.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">db</div></div></foreignObject></g><path d="M 350 257 L 350 460.63" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 350 465.88 L 346.5 458.88 L 350 460.63 L 353.5 458.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(333.5,343.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="36" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">发消息</div></div></foreignObject></g><path d="M 290 217 L 256.37 217" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 251.12 217 L 258.12 213.5 L 256.37 217 L 258.12 220.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 320 177 L 380 177 L 410 217 L 380 257 L 320 257 L 290 217 Z" fill="#f8cecc" stroke="#b85450" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(301.5,203.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="96" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 97px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">定时任务<div>读取未完成的消息</div></div></div></foreignObject></g><path d="M 145 377 L 220 377 L 220 263.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 220 258.12 L 223.5 265.12 L 220 263.37 L 216.5 265.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 85 407 L 85 528 L 313.63 528" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 318.88 528 L 311.88 531.5 L 313.63 528 L 311.88 524.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(125.5,523.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="36" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">发消息</div></div></foreignObject></g><rect x="25" y="347" width="120" height="60" fill="#fff2cc" stroke="#d6b656" pointer-events="none"/><g transform="translate(26.5,363.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="116" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 116px; white-space: normal; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">发消息，更新消息记录状态</div></div></foreignObject></g><path d="M 380 528 L 640 528 L 640 343.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 640 338.12 L 643.5 345.12 L 640 343.37 L 636.5 345.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(520.5,520.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="48" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">接收消息</div></div></foreignObject></g><path d="M 320 488 C 320 466.67 380 466.67 380 488 L 380 536 C 380 557.33 320 557.33 320 536 Z" fill="#d5e8d4" stroke="#82b366" stroke-miterlimit="10" pointer-events="none"/><path d="M 320 488 C 320 504 380 504 380 488" fill="none" stroke="#82b366" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(333.5,517.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="32" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 34px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">mafka</div></div></foreignObject></g><g transform="translate(52.5,130.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="48" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 49px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">基于事务</div></div></foreignObject></g><path d="M 706 217 L 753.63 217" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 758.88 217 L 751.88 220.5 L 753.63 217 L 751.88 213.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 639 107 L 639 7 L 83 7 L 83 100.63" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 83 105.88 L 79.5 98.88 L 83 100.63 L 86.5 98.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(299.5,1.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="96" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">通知上游事务完成</div></div></foreignObject></g><rect x="571" y="107" width="135" height="220" rx="20.25" ry="20.25" fill="#ffffff" stroke="#000000" pointer-events="none"/><rect x="581" y="167" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(616.5,190.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="48" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 49px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">本地事务</div></div></foreignObject></g><rect x="581" y="247" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(604.5,263.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="72" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 73px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">消息唯一标识<div>幂等判重</div></div></div></foreignObject></g><g transform="translate(608.5,130.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="48" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 49px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">基于事务</div></div></foreignObject></g><path d="M 770 193 C 770 171.67 830 171.67 830 193 L 830 241 C 830 262.33 770 262.33 770 241 Z" fill="#dae8fc" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="none"/><path d="M 770 193 C 770 209 830 209 830 193" fill="none" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(792.5,222.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="14" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 14px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">db</div></div></foreignObject></g><g transform="translate(201.5,80.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="36" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 37px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">生产方</div></div></foreignObject></g><g transform="translate(716.5,80.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="36" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 37px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">消费方</div></div></foreignObject></g></g></svg>